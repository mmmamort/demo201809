<!DOCTYPE html>
<html lang="en">

<head>
    <base href="/">
    <meta charset="UTF-8">
    <title>首页</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script type="text/javascript" src="/js/angular.js" charset="utf-8"></script>
    <script type="text/javascript" src="/js/angular-ui-router.js" charset="utf-8"></script>
    <script type="text/javascript" src="/js/angular-route.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="/js/jquery-1.12.4.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js" charset="utf-8"></script>
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/default.css">

</head>

<body ng-app="indexApp">
<!--盒子-->
<div class="container-fluid" ng-controller="indexCtrl">
    <ui-view>
        <!--顶层标题栏-->
        <div class="row">
            <div class=" col-xs-12 title text-center">
                {{title}}
            </div>
        </div>

        <!--轮播图-->
        <div id="carousel-example-generic" class="carousel slide row" data-ride="carousel">
            <!-- Indicators -->
            <ol class="carousel-indicators">
                <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
                <li data-target="#carousel-example-generic" data-slide-to="1"></li>
                <li data-target="#carousel-example-generic" data-slide-to="2"></li>
            </ol>

            <!-- Wrapper for slides -->
            <div class="carousel-inner" role="listbox">
                <div class="item active">
                    <img src="/img/p4.jpg" alt="...">
                    <div class="carousel-caption">
                    </div>
                </div>
                <div class="item">
                    <img src="/img/p5.jpg" alt="...">
                    <div class="carousel-caption">
                    </div>
                </div>
                <div class="item">
                    <img src="/img/p6.jpg" alt="...">
                    <div class="carousel-caption">
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
                <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
                <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>

        <!--最新帖子-->
        <div th:onclick="|redirect_note('${note.nid}')|" class="row bottom-solid align-padding-10">
            <!--第一行-->
            <div class="col-xs-12">
                <!--用户名-->
                <span th:text="${note.username}">xxx</span>
                <!--发帖时间-->
                <span th:text="${note.time}">20xx-xx-xx xx:xx:xx</span>
            </div>
            <!--第二行内容-->
            <div class="col-xs-12" style="margin-top: 5px" th:text="${note.title}">测试标题，测试标题，测试标题</div>
            <!--第二行内容-->
            <div class="col-xs-12" style="margin-top: 5px" th:text="${note.content}">测试内容，测试内容，测试内容</div>
        </div>

        <div ui-view="page"></div>

        <div th:replace="~{common/menu :: #menuId}"></div>

    </ui-view>

</div>
<script>
    // function redirect(code) {
    //     location.href = '/detail?code=' + code;
    // }

    $("[name='menu1']").css("color", "#22B0A3");

    function redirect_note(nid) {
        location.href = '/forum/note?nid=' + nid;
    }

    var app = angular.module('indexApp', ['ui.router']);

    app.config(function ($stateProvider, $locationProvider) {
        $stateProvider
            .state('index', {
                url: '',
                templateUrl: '../templates/index.html',
                params: {"pageNumber": null},
                controller: 'indexCtrl'
            })
            .state('detail', {
                url: '/detail',
                templateUrl: '../templates/detail.html',
                params: {
                    "code": null,
                    "pageNumber": null
                },
                controller: 'detailCtrl'
            })
            .state('page', {
                url: '/page',
                views: {
                    'page@': {
                        templateUrl: '../templates/page.html',
                        controller: 'pageCtrl'
                    }
                },
                params: {"pageNumber": null}
            });
        $locationProvider.html5Mode(true);
    });

    app.controller('detailCtrl', function ($scope, $state, $stateParams, httpService) {
        // $("[name='menu1']").css("color", "#22B0A3");
        httpService.requestPromise('GET', 'ball_history_detail', $stateParams).then(function (data) {
            $scope.historyDetail = data;
        });

        $scope.redirect = function (url) {
            $state.go(url, {pageNumber: $stateParams.pageNumber});
        }
    });

    app.controller('pageCtrl', function ($scope, $state, $stateParams, httpService) {
        httpService.requestPromise('GET', 'ball_history_page', {pageNumber: $stateParams.pageNumber}).then(function (data) {
            $scope.historyPage = data.content;
            $scope.pageNow = data.number;
            $scope.pages = data;

            let arr = new Array();
            if ($scope.pageNow - 2 < 0) {
                for (let i = 0; i <= 4; i++) {
                    arr.push(i + 1);
                }
            } else if ($scope.pages.totalPages - $scope.pageNow > 2) {
                for (let i = $scope.pageNow - 2; i <= $scope.pageNow + 2; i++) {
                    arr.push(i + 1);
                }
            } else {
                for (let i = $scope.pages.totalPages - 4; i <= $scope.pages.totalPages - 1; i++) {
                    arr.push(i + 1);
                }
            }
            $scope.liArr = arr;
        });

        $scope.redirect = function (url, param) {
            $state.go(url, param);
        }
    });

    app.controller('indexCtrl', function ($state, $scope, $stateParams) {
        $scope.title = "博彩首页";

        $state.go("page", {pageNumber: $stateParams.pageNumber});
    });

    app.factory('httpService', function ($http, $rootScope, $q) {
        var factory = {};

        factory.requestPromise = function (method, url, params) {
            let deferred = $q.defer();

            $http({
                method: method,
                url: url,
                params: params
            }).then(function successCallback(response) {
                    deferred.resolve(response.data);
                }
            );
            return deferred.promise;
        };

        factory.get = function (url) {
            $http({
                method: "GET",
                url: url,
            })
        };

        return factory;
    });
</script>

</body>

</html>